<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMOKE SHAQ STUDIO | ELITE PRO</title>
    <style>
        :root { --gold: #D4AF37; --diamond: #E5E4E2; --black: #050505; --dark-glass: rgba(0,0,0,0.92); }
        body { background: #000; color: white; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; overflow-x: hidden; }
        
        /* BRIGHT DIAMOND BACKGROUND */
        .bg-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('golddustbackdrop.png') center/cover, url('diamindbackgroud.jpeg') center/cover; background-blend-mode: overlay; filter: brightness(1.5) contrast(1.2); z-index: -2; }
        .overlay-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 10%, rgba(0,0,0,0.95) 90%); z-index: -1; }
        
        /* HEADER */
        .top-rocker { width: 100%; height: 100px; background: #000; border-bottom: 2px solid var(--gold); display: flex; align-items: center; justify-content: space-between; padding: 0 60px; box-sizing: border-box; position: sticky; top: 0; z-index: 1000; box-shadow: 0 10px 40px rgba(0,0,0,0.9); }
        .logo-text { color: var(--gold); font-weight: 900; font-size: 1.8rem; letter-spacing: 3px; text-transform: uppercase; text-shadow: 0 0 20px rgba(212,175,55,0.4); }
        
        .auth-status { display: flex; align-items: center; gap: 30px; }
        .login-btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 12px 28px; border-radius: 4px; font-weight: 700; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .login-btn:hover { background: var(--gold); color: black; box-shadow: 0 0 20px var(--gold); }
        .credit-display { display: none; align-items: center; gap: 15px; background: rgba(212,175,55,0.1); padding: 10px 25px; border-radius: 50px; border: 1px solid rgba(212,175,55,0.2); }
        .credit-val { color: var(--gold); font-weight: 900; font-size: 1.1rem; }

        .page-nav { display: flex; justify-content: center; gap: 40px; background: rgba(0,0,0,0.8); padding: 18px 0; border-bottom: 1px solid #222; backdrop-filter: blur(15px); }
        .nav-item { cursor: pointer; color: #555; font-weight: 900; font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; transition: 0.3s; }
        .nav-item.active { color: var(--gold); text-shadow: 0 0 15px var(--gold); }

        /* STUDIO LAYOUT */
        .main-layout { display: flex; justify-content: center; padding: 50px 20px; gap: 40px; max-width: 1600px; margin: 0 auto; }
        .sidebar { width: 250px; }
        .studio-card { flex: 1; max-width: 850px; background: var(--dark-glass); border: 1px solid #222; border-radius: 24px; padding: 40px; box-shadow: 0 0 100px rgba(0,0,0,1); }
        
        /* DYNAMIC GUIDE BOX */
        .guide-box { background: rgba(212,175,55,0.05); border: 1px solid var(--gold); border-radius: 15px; padding: 20px; margin-top: 20px; }
        .guide-box h3 { color: var(--gold); font-size: 0.8rem; margin-top: 0; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid rgba(212,175,55,0.2); padding-bottom: 10px; }
        .guide-text { font-size: 0.75rem; color: #ccc; line-height: 1.6; }
        .guide-text b { color: var(--gold); }

        .cost-badge { background: #000; border: 1px solid #222; border-left: 4px solid var(--gold); padding: 15px 25px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px; }
        label { color: var(--gold); font-size: 0.7rem; font-weight: 900; display: block; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1.5px; }
        select, textarea, input[type="file"], input[type="range"] { width: 100%; background: #000; border: 1px solid #333; color: white; padding: 18px; border-radius: 12px; margin-bottom: 25px; box-sizing: border-box; font-size: 0.95rem; }
        
        .magic-btn { background: #111; border: 1px solid #444; color: var(--gold); padding: 8px 15px; border-radius: 6px; font-size: 0.65rem; font-weight: 900; cursor: pointer; float: right; margin-top: -45px; position: relative; z-index: 10; text-transform: uppercase; transition: 0.3s; }
        .magic-btn:hover { background: var(--gold); color: #000; border-color: var(--gold); }

        .slider-label { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.6rem; color: #888; font-weight: 900; }

        .render-btn { width: 100%; padding: 25px; border: none; border-radius: 12px; background: linear-gradient(135deg, #D4AF37, #F9D976, #D4AF37); color: black; font-weight: 900; font-size: 1.2rem; cursor: pointer; text-transform: uppercase; letter-spacing: 4px; transition: 0.4s; }
        .render-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(212,175,55,0.4); }
        
        #studioOutput { margin-top: 50px; width: 100%; min-height: 500px; background: #000; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid #111; position: relative; overflow: hidden; }
        #studioOutput img, #studioOutput video { width: 100%; max-height: 800px; border-radius: 10px; }
        
        .dl-btn { margin-top: 25px; padding: 18px 40px; background: #111; border: 2px solid var(--gold); color: var(--gold); font-weight: 900; text-decoration: none; border-radius: 8px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 2px; transition: 0.3s; display: none; }
        .dl-btn:hover { background: var(--gold); color: black; }

        .ad-box { background: #000; border: 1px solid #222; border-radius: 12px; padding: 15px; text-align: center; margin-bottom: 30px; }
        .ad-box img { width: 100%; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }

        #loginModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); z-index: 10000; justify-content: center; align-items: center; }
        .modal-content { background: #080808; border: 1px solid var(--gold); padding: 60px; border-radius: 30px; text-align: center; width: 450px; }
        
        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
    </style>
</head>
<body>
    <div class="bg-layer"></div>
    <div class="overlay-layer"></div>

    <header class="top-rocker">
        <div class="logo-text">SMOKE SHAQ STUDIO</div>
        <div class="auth-status">
            <button id="authBtn" class="login-btn" onclick="openLogin()">SIGN IN / JOIN VIP</button>
            <div id="userPanel" class="credit-display">
                <span id="userHandle" style="font-size: 0.75rem; opacity: 0.5;"></span>
                <div class="credit-val"><span id="liveCredits">0</span> CREDITS</div>
                <button onclick="logout()" style="background:none; border:none; color:#555; cursor:pointer; font-size:0.6rem; margin-left:15px; font-weight:900;">[ EXIT ]</button>
            </div>
        </div>
    </header>

    <nav class="page-nav">
        <div class="nav-item active" onclick="setMode('img-to-img', this)">Image Studio</div>
        <div class="nav-item" onclick="setMode('img-to-video', this)">Video Engine</div>
        <div class="nav-item" onclick="setMode('lip-sync', this)">Pro Lip Sync</div>
    </nav>

    <div class="main-layout">
        <!-- LEFT SIDEBAR: ADS -->
        <aside class="sidebar">
            <div class="ad-box">
                <img src="banner.png">
                <a href="https://t.vlmai-3.com/396104/6924?aff_sub5=SF_006OG000004lmDN" style="color:var(--gold); font-weight:900; text-decoration:none; font-size:0.75rem; text-transform:uppercase;">Join Elite Club</a>
            </div>
            <div class="ad-box">
                <img src="banner.png">
                <a href="https://t.vlmai-3.com/396104/7477?aff_sub5=SF_006OG000004lmDN" style="color:var(--gold); font-weight:900; text-decoration:none; font-size:0.75rem; text-transform:uppercase;">Elite Rewards</a>
            </div>
        </aside>

        <main class="studio-card">
            <div class="cost-badge">
                <span style="color:#888; font-size:0.75rem; font-weight:900;">PRODUCTION COST:</span>
                <span style="color:var(--gold); font-weight:900;"><span id="costDisplay">5</span> CREDITS</span>
            </div>
            
            <label>Select Production Engine</label>
            <select id="engineSelect" onchange="updateCost()"></select>
            
            <label>Upload Reference Logo/Image</label>
            <input type="file" id="assetFile">

            <div id="sliderControl">
                <label>Logo Preservation (Image Influence)</label>
                <div class="slider-label"><span>MORE CREATIVE</span> <span>STAY TRUE TO LOGO</span></div>
                <input type="range" id="promptStrength" min="0.1" max="0.9" step="0.05" value="0.85">
            </div>
            
            <div id="timelineContainer" style="display:none; border-left: 2px solid var(--gold); padding-left: 25px; margin-bottom: 25px;">
                <label>Script / Dialogue</label>
                <textarea id="scriptText" rows="3" placeholder="Enter dialogue..."></textarea>
            </div>
            
            <div style="position:relative;">
                <label>Artistic Direction (Prompt)</label>
                <button class="magic-btn" onclick="pimpPrompt()">✨ Pimp My Prompt</button>
                <textarea id="studioPrompt" rows="4" placeholder="Describe what you want to see..."></textarea>
            </div>
            
            <button class="render-btn" onclick="startProduction()">Execute Production</button>
            
            <div id="studioOutput">
                <p id="standbyText" style="color:#111; font-weight:900; letter-spacing:10px; font-size:1.8rem;">STUDIO STANDBY</p>
                <div id="activeRender" style="display:none; text-align:center;">
                    <div style="color:var(--gold); font-size:1.2rem; font-weight:900; letter-spacing:3px; animation: pulse 1.5s infinite;">DIGITAL RENDERING...</div>
                </div>
                <div id="resultContainer"></div>
                <a id="downloadBtn" href="#" download="smoke-shaq-asset" class="dl-btn">Download Asset</a>
            </div>
        </main>

        <!-- RIGHT SIDEBAR: DYNAMIC PRO GUIDE -->
        <aside class="sidebar">
            <div class="guide-box">
                <h3>Elite Studio Guide</h3>
                <div id="dynamicGuide" class="guide-text">
                    <!-- Text injected by JS -->
                </div>
            </div>
            <div style="margin-top:20px; border:1px solid #222; border-radius:15px; padding:20px; text-align:center;">
                <h4 style="color:var(--gold); margin:0 0 10px 0;">REFILL CREDITS</h4>
                <a href="https://buy.stripe.com/6oU8wRfbO4wqdQueDE8N200" style="color:white; font-size:0.7rem; text-decoration:none; display:block; border:1px solid #444; padding:10px; border-radius:5px; margin-bottom:10px;">100 Credits - $10</a>
                <a href="https://buy.stripe.com/bJe7sNd3GbYS7s61QS8N201" style="color:black; font-weight:900; background:var(--gold); font-size:0.7rem; text-decoration:none; display:block; padding:10px; border-radius:5px;">550 Credits - $45</a>
            </div>
        </aside>
    </div>

    <!-- LIVE TALENT FEED -->
    <div style="padding: 60px 20px; background: #000; border-top: 3px solid var(--gold); text-align: center;">
        <h2 style="color:var(--gold); letter-spacing:10px; margin-bottom:40px; text-transform:uppercase;">LIVE TALENT FEED</h2>
        <div style="max-width:1200px; margin:0 auto;">
            <script src="https://crxcr2.com/cams-widget-ext/script?landing_id=%7Boffer_url_id%7D&genders=f&providers=chaturbate%2Cimlive&skin=1&containerAlignment=center&cols=4&rows=1&number=4&background=transparent&useFeed=1&animateFeed=1&smoothAnimation=1&ratio=1&verticalSpace=10px&horizontalSpace=10px&colorFilter=0&colorFilterStrength=0&AuxiliaryCSS=%0A&lang=en&token=e698f390-051d-11f1-8e58-ffbaf8ca8890&api_key=8389c2842c3c186e10c4f3f6db2a1d92304aff4d6d1e8e47f25b9627f078d33a"></script>
        </div>
    </div>

    <!-- MODAL -->
    <div id="loginModal">
        <div class="modal-content">
            <h2 style="color:var(--gold); margin-top:0;">VIP ACCESS</h2>
            <input type="email" id="loginEmail" class="modal-input" placeholder="Your VIP Email">
            <button class="render-btn" style="padding:18px;" onclick="processLogin()">AUTHENTICATE</button>
            <p onclick="closeLogin()" style="margin-top:25px; cursor:pointer; color:#444; font-size:0.7rem; text-decoration:underline;">CANCEL</p>
        </div>
    </div>

    <script>
        let currentMode = 'img-to-img';
        let userEmail = localStorage.getItem('studio_email') || null;
        let userCredits = 0;

        const guides = {
            'img-to-img': `<b>IMAGE STUDIO TIPS:</b><br><br>1. <b>Logo Preservation:</b> Keep slider at <b>0.85</b> for exact logos. Drop to <b>0.4</b> for artistic remixes.<br><br>2. <b>Magic Button:</b> Always click ✨ Pimp My Prompt to add cinematic lighting and textures.<br><br>3. <b>Assets:</b> Use high-contrast images for the best results.`,
            'img-to-video': `<b>VIDEO ENGINE TIPS:</b><br><br>1. <b>Base Image:</b> Start with a high-res image for the best video quality.<br><br>2. <b>Movement:</b> Describe motion in the prompt (e.g., "slow zoom", "smoke rising", "neon lights flickering").<br><br>3. <b>Text:</b> Complex text can warp in video; keep logo prompts simple.`,
            'lip-sync': `<b>LIP SYNC TIPS:</b><br><br>1. <b>Facial Clarity:</b> Use a headshot where the person is looking directly at the camera.<br><br>2. <b>Audio:</b> Ensure your script is clear. The AI will sync facial muscles to every syllable.<br><br>3. <b>Lighting:</b> Avoid shadows on the face for professional-grade realism.`
        };

        const modelLibrary = {
            'img-to-img': [{ id: 'flux-pro', name: 'FLUX 1.1 PRO (Masterpiece Stills)', cost: 5 }],
            'img-to-video': [{ id: 'kling-video', name: 'KLING 2.5 (Cinema Grade Motion)', cost: 15 }],
            'lip-sync': [{ id: 'omni-human', name: 'OMNI-HUMAN (Digital Soul Sync)', cost: 20 }]
        };

        function updateGuide() { document.getElementById('dynamicGuide').innerHTML = guides[currentMode]; }

        function pimpPrompt() {
            const promptArea = document.getElementById('studioPrompt');
            let text = promptArea.value.trim();
            if(!text) text = "Smoke Shaq Studio logo";
            const enhancements = ["cinematic 8k resolution", "intricate 3D textures", "volumetric lighting", "photorealistic shadows", "hyper-realistic rendering", "professional color grading"];
            const enhanced = `${text}, ${enhancements.sort(() => 0.5 - Math.random()).slice(0, 4).join(', ')}, masterpiece quality.`;
            promptArea.value = enhanced;
        }

        function openLogin() { document.getElementById('loginModal').style.display = 'flex'; }
        function closeLogin() { document.getElementById('loginModal').style.display = 'none'; }
        function processLogin() {
            const email = document.getElementById('loginEmail').value.toLowerCase().trim();
            if(!email.includes('@')) return alert("Enter valid email.");
            localStorage.setItem('studio_email', email);
            userEmail = email;
            loginUI(email);
            updateCredits();
            closeLogin();
        }
        function loginUI(email) {
            document.getElementById('authBtn').style.display = 'none';
            document.getElementById('userPanel').style.display = 'flex';
            document.getElementById('userHandle').innerText = email;
        }
        function logout() { localStorage.removeItem('studio_email'); window.location.reload(); }

        function setMode(mode, el) {
            currentMode = mode;
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('timelineContainer').style.display = (mode === 'lip-sync') ? 'block' : 'none';
            document.getElementById('sliderControl').style.display = (mode === 'img-to-img') ? 'block' : 'none';
            updateEngineDropdown();
            updateGuide();
        }

        function updateEngineDropdown() {
            const select = document.getElementById('engineSelect');
            select.innerHTML = modelLibrary[currentMode].map(m => `<option value="${m.id}">${m.name}</option>`).join('');
            updateCost();
        }

        function updateCost() {
            const select = document.getElementById('engineSelect');
            const model = modelLibrary[currentMode].find(m => m.id === select.value);
            if(model) document.getElementById('costDisplay').innerText = model.cost;
        }

        async function updateCredits() {
            if(!userEmail) return;
            try {
                const res = await fetch(`/api/credits?email=${userEmail}`);
                const data = await res.json();
                userCredits = data.credits || 0;
                document.getElementById('liveCredits').innerText = userCredits;
            } catch(e) {}
        }

        async function startProduction() {
            if(!userEmail) return openLogin();
            const cost = parseInt(document.getElementById('costDisplay').innerText);
            if(userCredits < cost) return alert("Insufficient credits.");

            const out = document.getElementById('studioOutput');
            const resultBox = document.getElementById('resultContainer');
            const dl = document.getElementById('downloadBtn');
            const standby = document.getElementById('standbyText');
            const rendering = document.getElementById('activeRender');
            
            standby.style.display = 'none';
            resultBox.innerHTML = '';
            dl.style.display = 'none';
            rendering.style.display = 'block';
            
            try {
                const file = document.getElementById('assetFile').files[0];
                let b64 = null;
                if(file) {
                    b64 = await new Promise((res) => {
                        const r = new FileReader();
                        r.onload = () => res(r.result);
                        r.readAsDataURL(file);
                    });
                }
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tool: currentMode,
                        modelId: document.getElementById('engineSelect').value,
                        prompt: document.getElementById('studioPrompt').value,
                        image: b64,
                        email: userEmail,
                        prompt_strength: parseFloat(document.getElementById('promptStrength').value),
                        script: document.getElementById('scriptText').value
                    })
                });
                const job = await res.json();
                poll(job.id);
            } catch (err) {
                alert("Error: " + err.message);
                rendering.style.display = 'none';
                standby.style.display = 'block';
            }
        }

        function poll(id) {
            const resultBox = document.getElementById('resultContainer');
            const dl = document.getElementById('downloadBtn');
            const rendering = document.getElementById('activeRender');
            const timer = setInterval(async () => {
                try {
                    const res = await fetch(`/api/status?id=${id}`);
                    const data = await res.json();
                    if (data.status === 'succeeded') {
                        clearInterval(timer);
                        rendering.style.display = 'none';
                        const resUrl = Array.isArray(data.output) ? data.output[0] : data.output;
                        const isVideo = resUrl.includes('.mp4') || resUrl.includes('.webm');
                        resultBox.innerHTML = isVideo 
                            ? `<video src="${resUrl}" controls autoplay loop></video>`
                            : `<img src="${resUrl}">`;
                        dl.href = resUrl;
                        dl.style.display = 'inline-block';
                        updateCredits();
                    } else if (data.status === 'failed') {
                        clearInterval(timer);
                        rendering.style.display = 'none';
                        resultBox.innerHTML = '<p style="color:red;">PRODUCTION FAILED</p>';
                    }
                } catch (e) {}
            }, 3000);
        }

        updateEngineDropdown();
        updateGuide();
        if(userEmail) { loginUI(userEmail); updateCredits(); }
    </script>
</body>
</html>
