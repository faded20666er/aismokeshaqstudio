<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Smoke Shaq Studio | Member Vault</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="logo-container">
            <img src="logo.jpg.jpg" alt="AI Smoke Shaq Logo" class="logo">
        </div>
        <div class="user-status">
            <button id="vaultBtn" onclick="toggleVault()">ACCESS VAULT</button>
            <div id="creditDisplay" style="display:none;">
                <span id="userEmail"></span> | <span id="userCredits">0</span> CREDITS
            </div>
        </div>
    </header>

    <main>
        <!-- Sidebar Tools -->
        <nav class="side-tools">
            <div class="tool-category">STUDIO TOOLS</div>
            <button class="tool-btn active" onclick="switchTool('lip-sync')">ðŸ‘„ Lip Sync AI</button>
            <button class="tool-btn" onclick="switchTool('img-video')">ðŸŽ¬ Image to Video</button>
            <button class="tool-btn" onclick="switchTool('face-swap')">ðŸŽ­ Face Swap</button>
            
            <div class="tool-category" style="margin-top:30px;">REFILL CREDITS</div>
            <a href="YOUR_STRIPE_LINK_10" class="refill-link">50 Credits - $10</a>
            <a href="YOUR_STRIPE_LINK_25" class="refill-link">200 Credits - $25</a>
            <a href="YOUR_STRIPE_LINK_50" class="refill-link highlight">500 Credits - $50</a>
        </nav>

        <!-- Main Workspace -->
        <section class="workspace">
            <div id="tool-lip-sync" class="tool-interface">
                <h2>Lip Sync AI</h2>
                <p class="tool-desc">Upload a photo and an audio file. The AI will make them speak in sync.</p>
                
                <div class="upload-grid">
                    <div class="upload-box" onclick="document.getElementById('inputImg').click()">
                        <input type="file" id="inputImg" hidden accept="image/*">
                        <span>Click to Upload Image</span>
                    </div>
                    <div class="upload-box" onclick="document.getElementById('inputAudio').click()">
                        <input type="file" id="inputAudio" hidden accept="audio/*">
                        <span>Click to Upload Audio</span>
                    </div>
                </div>

                <button class="generate-btn" onclick="generateAI()">GENERATE PRODUCTION</button>
                <div id="statusMessage"></div>
                <div id="resultContainer"></div>
            </div>
        </section>
    </main>

    <!-- Login Overlay -->
    <div id="loginOverlay" class="overlay">
        <div class="login-box">
            <h3>Enter Vault Email</h3>
            <p>Use the email you used for payment to access your credits.</p>
            <input type="email" id="emailInput" placeholder="email@example.com">
            <button onclick="login()">LOGIN</button>
        </div>
    </div>

    <script>
        let currentUser = localStorage.getItem('shaq_user');

        if (currentUser) {
            updateCreditDisplay();
        }

        function toggleVault() {
            document.getElementById('loginOverlay').style.display = 'flex';
        }

        async function login() {
            const email = document.getElementById('emailInput').value;
            if (email) {
                localStorage.setItem('shaq_user', email);
                document.getElementById('loginOverlay').style.display = 'none';
                updateCreditDisplay();
            }
        }

        async function updateCreditDisplay() {
            const email = localStorage.getItem('shaq_user');
            const res = await fetch(`/api/credits?email=${email}`);
            const data = await res.json();
            
            document.getElementById('vaultBtn').style.display = 'none';
            document.getElementById('creditDisplay').style.display = 'block';
            document.getElementById('userEmail').innerText = email;
            document.getElementById('userCredits').innerText = data.credits;
        }

        async function generateAI() {
            const email = localStorage.getItem('shaq_user');
            if (!email) return alert("Please login to the vault first!");

            const status = document.getElementById('statusMessage');
            status.innerText = "Processing... this takes about 60 seconds.";

            // In a real version, we'd upload the files to a CDN first. 
            // For now, we are sending a request to the backend.
            const response = await fetch('/api/generate', {
                method: 'POST',
                body: JSON.stringify({
                    email: email,
                    tool: 'lip-sync',
                    image: 'https://aismokeshaqstudio.shop/logo.jpg.jpg', // Placeholder
                    audio: 'URL_TO_AUDIO' 
                })
            });

            const data = await response.json();
            if (data.error) {
                status.innerText = "Error: " + data.error;
            } else {
                status.innerText = "Generation Started! Check back in 1 minute.";
            }
        }
    </script>
</body>
</html>
