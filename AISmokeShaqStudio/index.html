<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Smoke Shaq Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0a0a0a;
            color: #d4af37;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        .studio-border { border: 1px solid rgba(212, 175, 55, 0.3); }
        .studio-card { background: rgba(20, 20, 20, 0.95); border-radius: 8px; }
        .btn-gold { 
            background: linear-gradient(to bottom, #d4af37, #8a6d3b);
            color: black;
            font-weight: bold;
            text-transform: uppercase;
        }
        .nav-link { cursor: pointer; opacity: 0.6; font-size: 12px; letter-spacing: 1px; }
        .nav-link.active { opacity: 1; border-bottom: 2px solid #d4af37; color: white; }
        .tool-panel { display: none; }
        .tool-panel.active { display: block; }
    </style>
</head>
<body>
    <nav class="p-4 border-b border-yellow-900/30 flex justify-between items-center bg-black">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-gold rounded-full border border-yellow-600"></div>
            <span class="font-bold tracking-tighter text-xl">SMOKE SHAQ STUDIO</span>
        </div>
        <div class="text-xs bg-yellow-900/20 px-3 py-1 rounded-full border border-yellow-700/50">
            CREDITS: <span id="creditCount">...</span>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto p-6">
        <div class="flex gap-6 mb-8 justify-center border-b border-white/10 pb-2">
            <div onclick="setTool('face-swap')" id="tab-face-swap" class="nav-link active">FACE SWAP</div>
            <div onclick="setTool('img-to-video')" id="tab-img-to-video" class="nav-link">IMAGE TO VIDEO</div>
            <div onclick="setTool('lip-sync')" id="tab-lip-sync" class="nav-link">LIP SYNC</div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <div class="studio-card studio-border p-6 h-fit">
                <h3 class="text-xs font-bold mb-4">PRODUCTION SETTINGS</h3>
                
                <div id="panel-face-swap" class="tool-panel active space-y-4">
                    <input type="file" id="fs1" class="w-full text-xs">
                    <input type="file" id="fs2" class="w-full text-xs">
                </div>
                <div id="panel-img-to-video" class="tool-panel space-y-4">
                    <input type="file" id="iv1" class="w-full text-xs">
                    <input type="text" id="iv-p" placeholder="Describe motion" class="w-full bg-black border border-white/20 p-2 text-xs">
                </div>
                <div id="panel-lip-sync" class="tool-panel space-y-4">
                    <input type="file" id="ls1" class="w-full text-xs">
                    <input type="file" id="ls2" class="w-full text-xs">
                </div>

                <button onclick="runGen()" id="mainBtn" class="w-full btn-gold py-4 mt-6 rounded shadow-lg">Run Production</button>
            </div>

            <div class="lg:col-span-2 studio-card studio-border min-h-[400px] flex items-center justify-center relative bg-black/50">
                <div id="loading" class="hidden absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-10">
                    <div class="w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"></div>
                    <p class="text-[10px] mt-2 animate-pulse">PROCESSING...</p>
                </div>
                <div id="result" class="p-4">
                    <p class="text-white/20 uppercase text-xs tracking-[0.5em]">Studio Standby</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const email = "faded206@yahoo.com";
        let tool = 'face-swap';

        function setTool(t) {
            tool = t;
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('panel-'+t).classList.add('active');
        }

        async function fetchCredits() {
            try {
                const res = await fetch(`/api/credits?email=${email}`);
                const d = await res.json();
                document.getElementById('creditCount').innerText = d.credits || 0;
            } catch(e) { document.getElementById('creditCount').innerText = "0"; }
        }

        async function runGen() {
            const load = document.getElementById('loading');
            const resDiv = document.getElementById('result');
            load.classList.remove('hidden');
            
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ email, tool })
                });
                const data = await response.json();
                if(data.output) {
                    resDiv.innerHTML = `<img src="${data.output}" class="max-w-full border border-gold">`;
                } else {
                    alert(data.error);
                }
            } catch(e) {
                alert("Connection Error");
            } finally {
                load.classList.add('hidden');
                fetchCredits();
            }
        }
        fetchCredits();
    </script>
</body>
</html>
